<?php

/*************************************************************************************/
/****************************** REGISTER CONTROLLERS *********************************/
/*************************************************************************************/

	Controller::register("test")->when("GET", "/test/<param1>")->execute(
		array(Bind::URI("param1"), Bind::GET("param2")),
		function($x, $y) {
			return "Test page called with parameters : $x, $y";
		}
	);

/*************************************************************************************/
/******************************** DEFINE WRAPPERS ************************************/
/*************************************************************************************/
	
	$layout = Wrapper::create(function(Resource $resource) {
		View::page('site');
		return View::page()->set('content', $resource->content())->render();
	}); 

/*************************************************************************************/
/******************************** WRAP CONTROLLERS ***********************************/
/*************************************************************************************/
	
	Controller::find("**")->wrap($layout);

/*************************************************************************************/
/***************************** DISPATCH CLIENT REQUEST *******************************/
/*************************************************************************************/
	
	try {
		echo Controller::dispatch();
	}
	catch (Exception $e) {
		throw $e; // Do something more interesting here .
	}